# üé® **FRONTEND INTEGRATION : Nouvelle Architecture Images + BlurHash**

**Make the CHANGE - Guide d'int√©gration Frontend**
**Date :** Septembre 2025
**Auteur :** Agent DB Migration

---

## üìã **SOMMAIRE EXECUTIF**

### **üéØ Objectif**
Mettre √† jour le frontend pour exploiter la nouvelle architecture d'images avec hi√©rarchie visuelle et BlurHash pour une meilleure UX.

### **üîÑ Changements DB Effectu√©s**
- ‚úÖ **Producers** : `logo_url` + `cover_image` + `gallery_images[]` + `blur_hashes[]`
- ‚úÖ **Projects** : `hero_image` + `gallery_images[]` + `blur_hashes[]`
- ‚úÖ **Products** : `blur_hashes[]` ajout√© aux `images[]` existants

### **üöÄ Impact Frontend**
- **Performance** : Placeholders intelligents avec BlurHash
- **UX** : Hi√©rarchie visuelle claire (hero, logo, cover)
- **Maintenance** : Code plus organis√© et r√©utilisable

---

## üóÑÔ∏è **NOUVELLES STRUCTURES DE DONN√âES**

### **üè≠ Producers - Nouvelle Structure**
```typescript
interface Producer {
  // Ancien syst√®me (toujours pr√©sent pour compatibilit√©)
  images: string[]; // ‚ùå √Ä √©viter, utiliser la nouvelle structure

  // Nouveau syst√®me (√† utiliser)
  logo_url: string;        // üñºÔ∏è Image principale du producteur
  cover_image: string;     // üèûÔ∏è Banni√®re/cover du producteur
  gallery_images: string[]; // üñºÔ∏è Galerie compl√©mentaire (max 3-5 images)
  blur_hashes: Array<{     // üé® Placeholders intelligents
    url: string;
    blurhash: string;
    type: 'logo' | 'cover' | 'gallery';
  }>;
}
```

### **üèóÔ∏è Projects - Nouvelle Structure**
```typescript
interface Project {
  // Ancien syst√®me (toujours pr√©sent)
  images: string[]; // ‚ùå √Ä √©viter

  // Nouveau syst√®me (√† utiliser)
  hero_image: string;      // üñºÔ∏è Image principale du projet
  gallery_images: string[]; // üñºÔ∏è Galerie du projet (max 3-5 images)
  blur_hashes: Array<{     // üé® Placeholders intelligents
    url: string;
    blurhash: string;
    type: 'hero' | 'gallery';
  }>;
}
```

### **üõí Products - Structure Mise √† Jour**
```typescript
interface Product {
  // Syst√®me existant (mis √† jour)
  images: string[];        // ‚úÖ Toujours utilis√©
  blur_hashes: Array<{     // üÜï NOUVEAU : Placeholders intelligents
    url: string;
    blurhash: string;
    type: 'product';
  }>;
}
```

---

## üé® **IMPLEMENTATION BLURHASH FRONTEND**

### **1. Installation D√©pendances**
```bash
npm install react-blurhash blurhash
# ou
yarn add react-blurhash blurhash
```

### **2. Composant BlurHashImage**
```tsx
// components/ui/BlurHashImage.tsx
import { Blurhash } from 'react-blurhash';
import { useState } from 'react';

interface BlurHashImageProps {
  src: string;
  blurHash: string;
  alt: string;
  className?: string;
  width?: number;
  height?: number;
}

export function BlurHashImage({
  src,
  blurHash,
  alt,
  className = '',
  width = 400,
  height = 300
}: BlurHashImageProps) {
  const [imageLoaded, setImageLoaded] = useState(false);

  return (
    <div className={`relative ${className}`}>
      {/* Placeholder BlurHash */}
      {!imageLoaded && (
        <Blurhash
          hash={blurHash}
          width={width}
          height={height}
          resolutionX={32}
          resolutionY={32}
          punch={1}
          className="absolute inset-0 rounded-lg"
        />
      )}

      {/* Image r√©elle */}
      <img
        src={src}
        alt={alt}
        width={width}
        height={height}
        className={`absolute inset-0 object-cover rounded-lg transition-opacity duration-300 ${
          imageLoaded ? 'opacity-100' : 'opacity-0'
        }`}
        onLoad={() => setImageLoaded(true)}
        onError={() => setImageLoaded(true)} // Fallback si erreur
      />
    </div>
  );
}
```

### **3. Hook useImageWithBlurHash**
```tsx
// hooks/useImageWithBlurHash.ts
import { useMemo } from 'react';

interface BlurHashData {
  url: string;
  blurhash: string;
  type: string;
}

export function useImageWithBlurHash(
  blurHashes: BlurHashData[],
  imageUrl: string,
  type: string
) {
  return useMemo(() => {
    const blurHashData = blurHashes.find(
      (bh) => bh.url === imageUrl && bh.type === type
    );
    return {
      src: imageUrl,
      blurHash: blurHashData?.blurhash || '',
      hasBlurHash: !!blurHashData
    };
  }, [blurHashes, imageUrl, type]);
}
```

---

## üîÑ **MISES √Ä JOUR REQUISES PAR COMPOSANT**

### **1. ProducerCard / ProducerProfile**
```tsx
// AVANT (ancien syst√®me)
function ProducerCard({ producer }: { producer: Producer }) {
  return (
    <div>
      <img src={producer.images[0]} alt={producer.name} /> {/* ‚ùå Non hi√©rarchis√© */}
    </div>
  );
}

// APR√àS (nouveau syst√®me)
function ProducerCard({ producer }: { producer: Producer }) {
  const { src: logoSrc, blurHash: logoBlurHash, hasBlurHash: hasLogoBlur } =
    useImageWithBlurHash(producer.blur_hashes, producer.logo_url, 'logo');

  const { src: coverSrc, blurHash: coverBlurHash, hasBlurHash: hasCoverBlur } =
    useImageWithBlurHash(producer.blur_hashes, producer.cover_image, 'cover');

  return (
    <div>
      {/* Logo principal avec BlurHash */}
      <BlurHashImage
        src={logoSrc}
        blurHash={logoBlurHash}
        alt={`${producer.name} logo`}
        className="w-16 h-16 rounded-full"
      />

      {/* Cover image avec BlurHash */}
      <BlurHashImage
        src={coverSrc}
        blurHash={coverBlurHash}
        alt={`${producer.name} cover`}
        className="w-full h-48"
      />

      {/* Galerie (3 premi√®res images) */}
      <div className="grid grid-cols-3 gap-2">
        {producer.gallery_images.slice(0, 3).map((imageUrl, index) => {
          const { src, blurHash, hasBlurHash } = useImageWithBlurHash(
            producer.blur_hashes,
            imageUrl,
            'gallery'
          );

          return (
            <BlurHashImage
              key={index}
              src={src}
              blurHash={blurHash}
              alt={`${producer.name} gallery ${index + 1}`}
              className="w-full h-24"
            />
          );
        })}
      </div>
    </div>
  );
}
```

### **2. ProjectCard / ProjectDetail**
```tsx
// AVANT
function ProjectCard({ project }: { project: Project }) {
  return (
    <div>
      <img src={project.images[0]} alt={project.name} /> {/* ‚ùå Non hi√©rarchis√© */}
    </div>
  );
}

// APR√àS
function ProjectCard({ project }: { project: Project }) {
  const { src: heroSrc, blurHash: heroBlurHash, hasBlurHash: hasHeroBlur } =
    useImageWithBlurHash(project.blur_hashes, project.hero_image, 'hero');

  return (
    <div>
      {/* Hero image principale */}
      <BlurHashImage
        src={heroSrc}
        blurHash={heroBlurHash}
        alt={`${project.name} hero`}
        className="w-full h-64"
      />

      {/* Galerie du projet */}
      <div className="grid grid-cols-4 gap-2 mt-4">
        {project.gallery_images.map((imageUrl, index) => {
          const { src, blurHash, hasBlurHash } = useImageWithBlurHash(
            project.blur_hashes,
            imageUrl,
            'gallery'
          );

          return (
            <BlurHashImage
              key={index}
              src={src}
              blurHash={blurHash}
              alt={`${project.name} gallery ${index + 1}`}
              className="w-full h-24"
            />
          );
        })}
      </div>
    </div>
  );
}
```

### **3. ProductCard / ProductGallery**
```tsx
// AVANT
function ProductCard({ product }: { product: Product }) {
  return (
    <div>
      <img src={product.images[0]} alt={product.name} />
    </div>
  );
}

// APR√àS (avec BlurHash)
function ProductCard({ product }: { product: Product }) {
  // Image principale avec BlurHash
  const primaryImage = product.images[0];
  const { src, blurHash, hasBlurHash } = useImageWithBlurHash(
    product.blur_hashes,
    primaryImage,
    'product'
  );

  return (
    <div>
      <BlurHashImage
        src={src}
        blurHash={blurHash}
        alt={product.name}
        className="w-full h-48"
      />

      {/* Galerie des autres images */}
      <div className="flex gap-2 mt-2 overflow-x-auto">
        {product.images.slice(1, 4).map((imageUrl, index) => {
          const { src: thumbSrc, blurHash: thumbBlurHash } = useImageWithBlurHash(
            product.blur_hashes,
            imageUrl,
            'product'
          );

          return (
            <BlurHashImage
              key={index}
              src={thumbSrc}
              blurHash={thumbBlurHash}
              alt={`${product.name} view ${index + 2}`}
              className="w-20 h-20 flex-shrink-0"
            />
          );
        })}
      </div>
    </div>
  );
}
```

---

## üîß **MISES √Ä JOUR TECHNIQUES REQUISES**

### **1. Types TypeScript**
```typescript
// types/database.ts - Ajouter ces interfaces
export interface BlurHashData {
  url: string;
  blurhash: string;
  type: 'logo' | 'cover' | 'gallery' | 'hero' | 'product';
}

export interface Producer {
  // ... autres champs
  logo_url?: string;
  cover_image?: string;
  gallery_images: string[];
  blur_hashes: BlurHashData[];
}

export interface Project {
  // ... autres champs
  hero_image?: string;
  gallery_images: string[];
  blur_hashes: BlurHashData[];
}

export interface Product {
  // ... autres champs
  images: string[];
  blur_hashes: BlurHashData[];
}
```

### **2. Queries GraphQL/Database**
```typescript
// Mettre √† jour vos queries pour r√©cup√©rer les nouveaux champs
const GET_PRODUCER = gql`
  query GetProducer($id: ID!) {
    producer(id: $id) {
      id
      name
      logo_url
      cover_image
      gallery_images
      blur_hashes
    }
  }
`;

const GET_PROJECT = gql`
  query GetProject($id: ID!) {
    project(id: $id) {
      id
      name
      hero_image
      gallery_images
      blur_hashes
    }
  }
`;
```

### **3. API Routes (si utilis√©)**
```typescript
// Mettre √† jour vos API routes pour retourner les nouveaux champs
export async function GET(request: Request, { params }: { params: { id: string } }) {
  const producer = await db.producer.findUnique({
    where: { id: params.id },
    select: {
      id: true,
      name: true,
      logo_url: true,
      cover_image: true,
      gallery_images: true,
      blur_hashes: true,
    },
  });

  return Response.json(producer);
}
```

---

## üß™ **TESTING & VALIDATION**

### **1. Tests Visuels**
- ‚úÖ **BlurHash apparait** pendant le chargement des images
- ‚úÖ **Transition smooth** entre BlurHash et image r√©elle
- ‚úÖ **Fallback gracieux** si BlurHash manquant
- ‚úÖ **Performance** : pas de layout shift

### **2. Tests Fonctionnels**
```typescript
// tests/components/BlurHashImage.test.tsx
describe('BlurHashImage', () => {
  it('shows BlurHash placeholder initially', () => {
    render(<BlurHashImage src="test.jpg" blurHash="valid-hash" alt="test" />);
    expect(screen.getByRole('img')).toHaveAttribute('src', expect.stringContaining('blur'));
  });

  it('transitions to real image on load', async () => {
    render(<BlurHashImage src="test.jpg" blurHash="valid-hash" alt="test" />);
    const img = screen.getByRole('img');
    fireEvent.load(img);
    await waitFor(() => {
      expect(img).toHaveAttribute('src', 'test.jpg');
    });
  });
});
```

### **3. Performance Monitoring**
```typescript
// hooks/usePerformanceTracking.ts
export function useImageLoadPerformance() {
  const [metrics, setMetrics] = useState({
    blurHashTime: 0,
    imageLoadTime: 0,
    totalTime: 0,
  });

  // Track performance metrics
  return metrics;
}
```

---

## üìà **B√âN√âFICES ATTENDUS**

### **üéØ UX Improvements**
- **Loading Experience** : Placeholders intelligents vs gris uni
- **Perceived Performance** : Sentiment de rapidit√© accru
- **Visual Hierarchy** : Images principales mises en valeur
- **Professional Look** : Aspect plus moderne et soign√©

### **‚ö° Performance Gains**
- **Reduced Layout Shift** : Dimensions pr√©-calcul√©es
- **Better Caching** : BlurHash en cache local
- **Progressive Loading** : Image s'affiche progressivement
- **Bandwidth Optimization** : Placeholder l√©ger avant image lourde

### **üõ†Ô∏è Developer Experience**
- **Type Safety** : Types TypeScript complets
- **Reusable Components** : Composants modulaires
- **Easy Maintenance** : Logique centralis√©e
- **Consistent UX** : Patterns uniformes

---

## üöÄ **PLAN DE D√âPLOIEMENT**

### **Phase 1 : Composants Core (Priorit√© 1)**
- ‚úÖ Cr√©er `BlurHashImage` component
- ‚úÖ Cr√©er `useImageWithBlurHash` hook
- ‚úÖ Mettre √† jour les types TypeScript

### **Phase 2 : Pages Producers (Priorit√© 2)**
- ‚úÖ Mettre √† jour `ProducerCard`
- ‚úÖ Mettre √† jour `ProducerProfile`
- ‚úÖ Mettre √† jour `ProducerList`

### **Phase 3 : Pages Projects (Priorit√© 3)**
- ‚úÖ Mettre √† jour `ProjectCard`
- ‚úÖ Mettre √† jour `ProjectDetail`
- ‚úÖ Mettre √† jour `ProjectGallery`

### **Phase 4 : Pages Products (Priorit√© 4)**
- ‚úÖ Mettre √† jour `ProductCard`
- ‚úÖ Mettre √† jour `ProductGallery`
- ‚úÖ Mettre √† jour `ProductDetail`

### **Phase 5 : Optimisations (Priorit√© 5)**
- ‚úÖ Performance monitoring
- ‚úÖ Tests automatis√©s
- ‚úÖ Documentation d√©veloppeur

---

## ‚ùì **QUESTIONS FR√âQUENTES**

### **Q: Que faire si un BlurHash est manquant ?**
**R:** Le composant `BlurHashImage` g√®re automatiquement le fallback vers un placeholder gris.

### **Q: Comment migrer progressivement ?**
**R:** Utilisez les anciennes propri√©t√©s `images[]` comme fallback pendant la migration.

### **Q: Impact sur les performances ?**
**R:** N√©gligeable - les BlurHash sont tr√®s l√©gers (~20-30 bytes chacun).

### **Q: Compatible mobile ?**
**R:** Oui, `react-blurhash` est optimis√© pour mobile et utilise WebGL/Canvas.

---

## üìû **SUPPORT & CONTACTS**

**En cas de questions :**
- üìß **Agent DB :** Pour questions sur le sch√©ma DB
- üìß **√âquipe Frontend :** Pour questions d'impl√©mentation
- üìß **Designer UX :** Pour questions d'exp√©rience utilisateur

**Documentation li√©e :**
- üîó `DB_IMAGES_MIGRATION_PLAN.md` - Plan de migration DB
- üîó `generate-blurhash-sql.sql` - Script de g√©n√©ration BlurHash
- üîó Composants existants d'upload d'images

---

## ‚úÖ **CHECKLIST DE VALIDATION**

- [ ] `BlurHashImage` component cr√©√© et test√©
- [ ] `useImageWithBlurHash` hook impl√©ment√©
- [ ] Types TypeScript mis √† jour
- [ ] ProducerCard utilise `logo_url` + `cover_image`
- [ ] ProjectCard utilise `hero_image`
- [ ] ProductCard utilise BlurHash pour `images[]`
- [ ] Tests automatis√©s ajout√©s
- [ ] Performance monitoring en place
- [ ] Documentation mise √† jour

**Statut :** üü° **Pr√™t pour impl√©mentation**

---
*Document g√©n√©r√© automatiquement suite √† la migration DB - Make the CHANGE*
